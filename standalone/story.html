<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Heart Pocket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- React & ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            serif: ['Georgia', 'Playfair Display', 'serif'],
          },
          colors: {
            night: {
              50: '#f0f4ff',
              100: '#e0e9ff',
              200: '#c7d7fe',
              300: '#a4b8fc',
              400: '#8193f8',
              500: '#6370f2',
              600: '#4f4ee8',
              700: '#3d3bd4',
              800: '#2e2fb3',
              900: '#2a2a8f',
              950: '#1a1a52',
            },
            ember: {
              50: '#fff7ed',
              100: '#ffedd5',
              200: '#fed7aa',
              300: '#fdba74',
              400: '#fb923c',
              500: '#f97316',
              600: '#ea580c',
              700: '#c2410c',
              800: '#9a3412',
              900: '#7c2d12',
            }
          }
        }
      }
    }
  </script>

  <style>
    /* Custom Utilities extracted from src/index.css */
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #1a1a52 0%, #2d4a7c 50%, #1a1a52 100%);
      background-image:
        radial-gradient(circle at 20% 50%, rgba(79, 78, 232, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(251, 146, 60, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(253, 186, 116, 0.1) 0%, transparent 50%);
      background-attachment: fixed;
      color: #f8fafc;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
    }

    .glass-warm {
      background: rgba(45, 74, 124, 0.4);
      backdrop-filter: blur(20px) saturate(160%);
      -webkit-backdrop-filter: blur(20px) saturate(160%);
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow:
        0 8px 32px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .animate-float {
      animation: float 4s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- Story Data ---
    const DEFAULT_TITLE = "The Heart Pocket";
    const DEFAULT_SUBTITLE = "For Leif and Lewie";

    const DEFAULT_PAGES = [
      "Once upon a time, there were two brave little explorers named Leif and Lewie. They were masters of their own backyard kingdom. They loved to laugh until their bellies hurt, build forts out of sofa cushions that reached the sky, and make funny sounds that made their daddy smile so big it almost broke his face.",
      "Their daddy loved them more than all the stars in the midnight sky. He thought about them every morning when the sun stretched its golden arms over the horizon, and every night when the moon tucked itself into the clouds to sleep.",
      "One day, the daddy had to go on a long trip. But even when he was far away, across hills and oceans, he kept their love right in his heart pocketâ€”a little invisible pocket that never, ever runs out of space.",
      "Whenever the boys laughed at a cartoon, or built a Lego tower that didn't fall down, or looked up at the bright white moon, the daddy could feel it. It felt like a warm light reaching all the way from their home, zooming through the air, and landing right in his chest."
    ];

    const DEFAULT_IMAGES = [
      "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=800&q=80" // Placeholder beach/nature image
    ];

    // --- Icons ---
    // We can't easily use LucideReact icons as components like <X /> in standalone without build step unless we use lucide-react CDN which exposes them.
    // However, lucide script creates global 'lucide' object with createIcons.
    // To use them in React, we might need a wrapper or just simple SVGs.
    // Actually, simple SVGs are safer for standalone file.
    // Let's create simple SVG components for the icons used.

    const IconX = ({ size = 24, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>
    );

    const IconPlay = ({ size = 24, fill = "none", className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="6 3 20 12 6 21 6 3"/></svg>
    );

    const IconPause = ({ size = 24, fill = "none", className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="4" height="16" x="6" y="4"/><rect width="4" height="16" x="14" y="4"/></svg>
    );

    const IconSkipBack = ({ size = 24, fill = "none", className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="19 20 9 12 19 4 19 20"/><line x1="5" x2="5" y1="19" y2="5"/></svg>
    );

    const IconSkipForward = ({ size = 24, fill = "none", className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 4 15 12 5 20 5 4"/><line x1="19" x2="19" y1="5" y2="19"/></svg>
    );

    const IconChevronDown = ({ size = 24, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m6 9 6 6 6-6"/></svg>
    );

    // --- ReaderView Component ---
    const ReaderView = ({ story, onBack }) => {
      // Logic from src/components/ReaderView.tsx
      // Adapted to treat pages as the main content to step through if no images

      const pages = story.pages || [];
      const [idx, setIdx] = useState(0);
      const [playing, setPlaying] = useState(false);

      // Calculate duration based on text length if no images?
      // Or just default 10 seconds per page for reading
      const DURATION_PER_PAGE = 10;
      const [currentTime, setCurrentTime] = useState(0);
      const totalDuration = pages.length * DURATION_PER_PAGE;

      // Reset timer when index changes manually? No, keep global flow.
      // But we track progress per page or global?
      // Original code tracked image slideshow.
      // Let's adapt: Auto-advance pages.

      useEffect(() => {
        let t;
        if (playing && pages.length > 1) {
          t = setInterval(() => {
             // Advance page every DURATION_PER_PAGE seconds
             // Check if we need to advance
          }, 1000);
        }
        return () => clearInterval(t);
      }, [playing, pages.length]);

      // Simpler auto-play implementation for text story
      useEffect(() => {
        let interval;
        if (playing) {
          interval = setInterval(() => {
            setCurrentTime(prev => {
              const next = prev + 1;
              // Check if we should advance page
              const pageIndex = Math.floor(next / DURATION_PER_PAGE);
              if (pageIndex > idx && pageIndex < pages.length) {
                setIdx(pageIndex);
              }
              if (next >= totalDuration) {
                setPlaying(false);
                return 0; // or stop
              }
              return next;
            });
          }, 1000);
        }
        return () => clearInterval(interval);
      }, [playing, idx, pages.length, totalDuration]);

      // Sync index change to currentTime if user manually skips
      useEffect(() => {
        const expectedTimeStart = idx * DURATION_PER_PAGE;
        if (currentTime < expectedTimeStart || currentTime >= (idx + 1) * DURATION_PER_PAGE) {
           setCurrentTime(expectedTimeStart);
        }
      }, [idx]);

      const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      };

      const progress = (currentTime / totalDuration) * 100;

      const handlePrevious = () => {
        setIdx(prev => (prev === 0 ? pages.length - 1 : prev - 1));
      };

      const handleNext = () => {
        setIdx(prev => (prev + 1) % pages.length);
      };

      const currentPage = pages[idx];
      // Use a placeholder image if none exists
      const currentImage = currentPage.images?.[0]?.url || "https://images.unsplash.com/photo-1490730141103-6cac27aaab94?auto=format&fit=crop&w=800&q=80";

      return (
        <div className="fixed inset-0 bg-night-950 z-[100] overflow-hidden flex items-center justify-center">
          {/* Background */}
          <div className="absolute inset-0">
            <div className="absolute inset-0 bg-gradient-to-br from-night-950 via-night-900 to-night-950 opacity-95" />
            <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,_rgba(79,78,232,0.1),transparent_70%)]" />
          </div>

          {/* Top Controls */}
          <div className="absolute top-6 left-6 right-6 flex items-center justify-between z-10">
            <button
              onClick={onBack}
              className="w-12 h-12 glass-warm rounded-full flex items-center justify-center text-white border border-white/15 hover:bg-white/10 active:scale-95 transition-all"
            >
              <IconX size={24}/>
            </button>
            <div className="text-ember-300 text-sm font-semibold">BEDTIME MODE</div>
          </div>

          {/* Story Card */}
          <div className="relative max-w-md w-full mx-auto px-6">
            <div className="glass-warm rounded-3xl overflow-hidden shadow-2xl border border-white/15">

              {/* Story Content Area */}
              <div className="relative min-h-[400px] flex flex-col">
                {/* Image Area */}
                <div className="h-48 relative overflow-hidden">
                   <img src={currentImage} className="w-full h-full object-cover opacity-80" alt="Story art" />
                   <div className="absolute inset-0 bg-gradient-to-t from-night-900 via-transparent to-transparent"></div>
                </div>

                {/* Text Area */}
                <div className="p-6 text-center flex-1 flex flex-col justify-center items-center -mt-12 relative z-10">
                   {/* Title on first page only? Or always small? */}
                   {idx === 0 && (
                     <h2 className="text-white text-2xl font-bold mb-4 drop-shadow-lg">{story.title}</h2>
                   )}

                   <p className="text-slate-100 text-lg leading-relaxed font-serif drop-shadow-md">
                     {currentPage.text}
                   </p>
                </div>

                {/* Progress Info */}
                <div className="px-6 pb-2">
                   <div className="h-1.5 bg-white/10 rounded-full overflow-hidden mb-1">
                      <div
                        className="h-full bg-ember-400 rounded-full transition-all duration-1000"
                        style={{ width: `${progress}%` }}
                      />
                    </div>
                    <div className="flex justify-between text-xs text-slate-300">
                      <span>{formatTime(currentTime)}</span>
                      <span>{formatTime(totalDuration)}</span>
                    </div>
                </div>
              </div>

              {/* Playback Controls */}
              <div className="p-6 flex items-center justify-center gap-4 bg-white/5 border-t border-white/5">
                <button
                  onClick={handlePrevious}
                  className="w-12 h-12 glass-warm rounded-full flex items-center justify-center text-slate-300 hover:text-white hover:bg-white/10 active:scale-95 transition-all border border-white/10"
                >
                  <IconSkipBack size={20} fill="currentColor" />
                </button>

                <button
                  onClick={() => setPlaying(!playing)}
                  className="w-20 h-20 bg-gradient-to-br from-ember-400 to-ember-500 rounded-full flex items-center justify-center text-white shadow-xl shadow-ember-500/40 hover:shadow-2xl hover:scale-105 active:scale-95 transition-all border border-ember-300/30"
                >
                  {playing ? (
                    <IconPause size={32} fill="currentColor" />
                  ) : (
                    <IconPlay size={32} fill="currentColor" className="ml-1" />
                  )}
                </button>

                <button
                  onClick={handleNext}
                  className="w-12 h-12 glass-warm rounded-full flex items-center justify-center text-slate-300 hover:text-white hover:bg-white/10 active:scale-95 transition-all border border-white/10"
                >
                  <IconSkipForward size={20} fill="currentColor" />
                </button>
              </div>
            </div>

            {/* Swipe Hint */}
            <div className="mt-6 text-center">
              <div className="text-slate-400 text-sm flex items-center justify-center gap-2">
                Page {idx + 1} of {pages.length}
              </div>
            </div>
          </div>
        </div>
      );
    };

    // --- App Component ---
    const App = () => {
      const story = {
        title: DEFAULT_TITLE,
        tagline: DEFAULT_SUBTITLE,
        pages: DEFAULT_PAGES.map((text) => ({ text, images: [] }))
      };

      return (
        <ReaderView
          story={story}
          onBack={() => alert("Back to Library (Demo)")}
        />
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
